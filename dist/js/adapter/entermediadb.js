!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.AssetPickerAdapterEntermediadb=e()}}(function(){return function e(t,s,i){function n(r,o){if(!s[r]){if(!t[r]){var l="function"==typeof require&&require;if(!o&&l)return l(r,!0);if(a)return a(r,!0);var d=new Error("Cannot find module '"+r+"'");throw d.code="MODULE_NOT_FOUND",d}var h=s[r]={exports:{}};t[r][0].call(h.exports,function(e){var s=t[r][1][e];return n(s?s:e)},h,h.exports,e,t,s,i)}return s[r].exports}for(var a="function"==typeof require&&require,r=0;r<i.length;r++)n(i[r]);return n}({1:[function(e,t,s){t.exports={translations:{description:{en:"EnterMediaDB on {{config.url}}",de:"EnterMediaDB auf {{config.url}}"}},template:e("./template.html"),http:function(){var e={base:this.config.url.replace(/\/+$/,"")+"/mediadb/services",validate:function(e){e.data=e.json(),"ok"!==e.data.response.status?this.login(function(e,t,s){this.http.post("authentication/login",{id:e,password:t},{validate:function(e){e.data=e.json(),e.isValid("ok"===e.data.response.status)}}).then(function(e){s("invalidlogin"!==e.data.results.status)})}).then(e.reload):e.isValid()}};return e},data:function(){return{category:null,search:null,items:null,results:{},extensions:null}},watch:{"appConfig.pick":{handler:function(e){var t=this.assembleTerms();this.extensions=e.extensions;var s=this.assembleTerms();if(t.hash!==s.hash&&this.results[t.hash]){for(var i=this.results[t.hash].items;i.length>0;)i.pop();this.loadAssets(i)}},immediate:!0}},dateFormat:"YYYY-MM-DDTHH:mm:ss",methods:{assembleTerms:function(){var e=[],t=function(t,s,i){e.push({field:t,operator:s,value:i})};return this.category&&t("category","exact",this.category.id),this.search&&t("description","freeform",this.search),this.extensions&&this.extensions.length&&t("fileformat","matches",this.extensions.join("|")),e.length||t("id","matches","*"),e},loadAssets:function(e){var t=this.assembleTerms(),s=JSON.stringify(t),i=this.results[s];if(i){if(e&&i.items!==e&&(Array.prototype.push.apply(e,i.items),e.total=i.items.total,e.loading=i.items.loading,e.query=s,i.items=e),i.page===i.pages)return this.$promise(function(e){e(i)})}else i={page:0,pages:0,items:e||[]},i.items.total=i.items.total||i.items.length,this.results[s]=i;return i.items.loading=!0,i.items.query=s,this.http.post("module/asset/search",{page:""+(i.page+1),hitsperpage:"20",query:{terms:t}}).then(function(e){return i.items.query===s&&(i.page=parseInt(e.data.response.page),i.pages=parseInt(e.data.response.pages),i.items.total=parseInt(e.data.response.totalhits),i.items.loading=!1,e.data.results.forEach(function(e){var t=this.createItem({id:e.id,query:s,type:e.isfolder?"file":"dir",name:e.assettitle||e.name||e.primaryfile,title:e.assettitle,extension:e.fileformat.id,created:this.parseDate(e.assetcreationdate||e.assetaddeddate),modified:this.parseDate(e.assetmodificationdate),thumbnail:this.url("/emshare/views/modules/asset/downloads/preview/thumb/"+encodeURI(e.sourcepath)+"/thumb.jpg",this.config.url),data:e});i.items.push(t)}.bind(this))),i}.bind(this))}},events:{"select-item":function(e){return"entrypoint"!==e||(this.category=null,this.search=null,this.loadAssets().then(function(e){this.items=e.items,this.$parent.$dispatch("select-item",this)}.bind(this)),void 0)},"load-more-items":function(e){this.loadAssets(e)},search:function(e,t){return this.search=e,this.loadAssets(t),!0},"category-load-items":function(e){this.http.post("lists/search/category",{hitsperpage:"100",query:{terms:[{field:"parentid",operator:"exact",value:e.item?e.item.id:"index"}]}}).then(function(t){e.items=t.data.results.map(function(e){return this.createItem({id:e.id,name:e.name,type:"category",data:e})}.bind(this))})},"category-select-item":function(e){this.category=e.item,this.search=null,this.loadAssets(e.items).then(function(t){e.selected&&this.$dispatch("select-item",e)}.bind(this))}}}},{"./template.html":2}],2:[function(e,t,s){t.exports='<div>\n    <tree :fetch="fetch" name="category" :types="[\'category\']"></tree>\n</div>'},{}]},{},[1])(1)});
//# sourceMappingURL=../maps/adapter/entermediadb.js.map
