!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.AssetPickerAdapterGoogledrive=e()}}(function(){return function e(t,i,n){function o(a,r){if(!i[a]){if(!t[a]){var p="function"==typeof require&&require;if(!r&&p)return p(a,!0);if(s)return s(a,!0);var d=new Error("Cannot find module '"+a+"'");throw d.code="MODULE_NOT_FOUND",d}var h=i[a]={exports:{}};t[a][0].call(h.exports,function(e){var i=t[a][1][e];return o(i?i:e)},h,h.exports,e,t,i,n)}return i[a].exports}for(var s="function"==typeof require&&require,a=0;a<n.length;a++)o(n[a]);return o}({1:[function(e,t,i){var n;t.exports={translations:{description:{en:'Google Drive ({{config.email || "Not connected"}})',de:'Google Drive ({{config.email || "Nicht verbunden"}})'},document:{en:"Doc",de:"Doc"},spreadsheet:{en:"Spreadsheet",de:"Tabelle"},presentation:{en:"Presentation",de:"PrÃ¤sentation"},map:{en:"My Maps",de:"My Maps"},form:{en:"Form",de:"Formular"},drawing:{en:"Drawing",de:"Zeichnung"},folder:{en:"Folder",de:"Ordner"}},http:{base:"https://content.googleapis.com/drive/v3",http:{throttle:100}},created:function(){this.auth&&(this.config.email=this.auth.email)},stored:{auth:!0},methods:{loadAuth2:function(){return this.$promise(function(e){n?e():this.util.loadScript("https://apis.google.com/js/platform.js",function(){gapi.load("auth2",function(){gapi.auth2.init({client_id:this.config.client_id,scope:"https://www.googleapis.com/auth/drive.readonly"}).then(function(t){n=t,e()})}.bind(this))}.bind(this))})},signIn:function(){return this.$promise(function(e){this.loadAuth2().then(function(){if(n.isSignedIn.get())e(n.currentUser.get());else{var t=this.$parent.open;this.$parent.open=!0;var i=this.$el.appendChild(document.createElement("div"));i.className="panel panel-default";var o=i.appendChild(document.createElement("div"));o.className="btn btn-default btn-block",o.innerHTML=this.t("login.login"),n.attachClickHandler(o,{},function(n){this.$parent.open=t,this.$el.removeChild(i),e(n)}.bind(this))}}.bind(this))})},setupToken:function(){return this.$promise(function(e){var t=function(){this.$options.http.params={key:this.config.api_key},this.$options.http.headers={Authorization:"Bearer "+this.auth.token},e()}.bind(this);this.auth&&this.auth.expires_at<Date.now()&&(this.auth=null),this.auth?t():this.signIn().then(function(e){this.auth={token:e.getAuthResponse().access_token,expires_at:e.getAuthResponse().expires_at,email:e.getBasicProfile().getEmail()},t()}.bind(this))})},loadItems:function(){return this.$promise(function(e){this.setupToken().then(function(e){this.http.get("files",{params:{key:this.config.api_key,q:"'root' in parents"}})}.bind(this))})}},events:{"load-items":function(e){this.setupToken().then(function(t){this.http.get("files",{params:{key:this.config.api_key,q:"'"+(e.item?e.item.id:"root")+"' in parents and trashed = false",fields:"files,kind"}}).then(function(t){console.log(t),e.items=JSON.parse(t.data).files.map(function(e){var t,i="application/vnd.google-apps.folder"===e.mimeType?"dir":"file";if(e.mimeType.indexOf("/vnd.google-apps.")>0){var n=e.mimeType.split(".").pop();t="Google "+(this.t(n)||n[0].toUpperCase()+n.substr(1))}return this.createItem({id:e.id,name:e.name,type:i,mediaType:{icon:e.iconLink,iconBig:"file"===i&&e.iconLink?e.iconLink.replace(/\/icon_[0-9]+_([^_]+)_[^\/]+/,"/mediatype/icon_1_$1_x128.png"):void 0,label:t},extension:e.fileExtension,thumbnail:e.thumbnailLink,data:e})}.bind(this)),console.log(e.items)})}.bind(this))}}}},{}]},{},[1])(1)});
//# sourceMappingURL=../maps/adapter/googledrive.js.map
