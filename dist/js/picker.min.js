!function n(t,e,i){function o(r,a){if(!e[r]){if(!t[r]){var c="function"==typeof require&&require;if(!a&&c)return c(r,!0);if(s)return s(r,!0);var d=new Error("Cannot find module '"+r+"'");throw d.code="MODULE_NOT_FOUND",d}var l=e[r]={exports:{}};t[r][0].call(l.exports,function(n){var e=t[r][1][n];return o(e?e:n)},l,l.exports,n,t,e,i)}return e[r].exports}for(var s="function"==typeof require&&require,r=0;r<i.length;r++)o(i[r]);return o}({1:[function(n,t,e){function i(){var n=document.createElement("style");return n.setAttribute("type","text/css"),n}var o=[],s=[];t.exports=function(n,t){t=t||{};var e=t.prepend===!0?"prepend":"append",r=void 0!==t.container?t.container:document.querySelector("head"),a=o.indexOf(r);a===-1&&(a=o.push(r)-1,s[a]={});var c;return void 0!==s[a]&&void 0!==s[a][e]?c=s[a][e]:(c=s[a][e]=i(),"prepend"===e?r.insertBefore(c,r.childNodes[0]):r.appendChild(c)),c.styleSheet?c.styleSheet.cssText+=n:c.textContent+=n,c}},{}],2:[function(n,t,e){t.exports=".assetpicker-modal {\n    position: fixed;\n    top: 0;\n    bottom: 0;\n    left: 0;\n    right: 0;\n    background: rgba(0, 0, 0, 0);\n    z-index: -1;\n    transition: background 0.2s, z-index 0s 0.2s;\n}\n.assetpicker-modal.assetpicker-modal-open {\n    z-index:3000;\n    background: rgba(0, 0, 0, 0.8);\n    transition: background 0.2s\n}\n.assetpicker-modal .assetpicker-modal-inner {\n    position: absolute;\n    left:30px;\n    right:30px;\n    top:30px;\n    bottom:30px;\n    background: #fff;\n    opacity: 0;\n    transition: opacity 0.1s 0.1s;\n    border-radius: 4px;\n    overflow: hidden;\n}\n.assetpicker-modal.assetpicker-modal-open .assetpicker-modal-inner {\n    opacity: 1;\n}\n.assetpicker-modal .assetpicker-modal-inner iframe {\n    position: absolute;\n    width:100%;\n    height: 100%;\n    overflow: hidden;\n    border: none;\n}\n"},{}],3:[function(n,t,e){t.exports='<div class="assetpicker-modal">\n    <div class="assetpicker-modal-inner">\n        <iframe src="">\n            Ehm, without iframes i ain\'t do nothing.\n        </iframe>\n    </div>\n</div>\n'},{}],4:[function(n,t,e){var i=n("insert-css"),o=function(n,t){n.className.split(" ").indexOf(t)===-1&&(n.className+=" "+t)},s=function(n,t){for(var e=n.className.split(" "),i=[],o=0,s=e.length;o<s;o++)e[o]!==t&&i.push(e[o]);n.className=i.join(" ")},r=function(){var n=document.createElement("div"),t={transition:"transitionend",OTransition:"otransitionend",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(var e in t)if(t.hasOwnProperty(e)&&void 0!==n.style[e])return t[e]}(),a=function(n){var t=window.getComputedStyle(n,null),e=["transitionDuration","oTransitionDuration","MozTransitionDuration","webkitTransitionDuration"],i=e.filter(function(n){if("string"==typeof t[n]&&t[n].match(/[1-9]/))return!0});return!!i.length};t.exports=n("../../util/createClass")({construct:function(n){n&&Object.keys(n).forEach(function(t){this.options[t]=n[t]}.bind(this))},options:{template:n("./index.html"),css:n("./index.css"),openClassName:"assetpicker-modal-open",src:null},modal:null,frame:null,render:function(){this.options.css&&i(this.options.css);var n=document.createElement("div");n.innerHTML=this.options.template,this.modal=n.children[0],this.modal.addEventListener("click",function(n){n.target===this.modal&&this.close()}.bind(this)),this.frame=this.modal.querySelector("iframe"),document.body.appendChild(this.modal),this._modalClass=this.modal.className},open:function(){if(!this.modal){this.render();var n=this;return void window.setTimeout(function(){n.open()},1)}this.frame.src=this.options.src,o(this.modal,this.options.openClassName)},_closed:function(){this.frame.src=""},close:function(){if(r&&a(this.modal)){var n=function(){this.modal.removeEventListener(r,n),this._closed()}.bind(this);this.modal.addEventListener(r,n)}else this._closed();s(this.modal,this.options.openClassName)}})},{"../../util/createClass":6,"./index.css":2,"./index.html":3,"insert-css":1}],5:[function(n,t,e){var i=n("./components/modal"),o=function(){var n=document.getElementsByTagName("script");return n[n.length-1].src}(),s=n("./util/createClass")({construct:function(n){document.addEventListener("DOMContentLoaded",this.init.bind(this)),this.options.modal.src||(this.options.modal.src=o.split("/").slice(0,-3).join("/"))},modal:null,options:{app:{},input:{selector:'[rel="assetpicker"]'},modal:{src:null}},trustedOrigin:null,init:function(){var n=this.options.modal.src.match(/^http:\/\/[^\/]+/);this.trustedOrigin=n?n[0]:document.location.origin,this.modal=new i(this.options.modal),document.querySelectorAll(this.options.input.selector).forEach(this.initInput.bind(this));var t=window.addEventListener?"addEventListener":"attachEvent",e=window[t],o="attachEvent"==t?"onmessage":"message";e(o,function(n){var t=n.origin||n.originalEvent.origin;t===this.trustedOrigin&&this.handleMessageFromApp(n.data)}.bind(this),!1)},initInput:function(n){n.addEventListener("click",function(n){n.preventDefault(),this.modal.open()}.bind(this))},handleMessageFromApp:function(n){"cancel"===n&&this.modal.close()}});window.AssetPicker=new s},{"./components/modal":4,"./util/createClass":6}],6:[function(n,t,e){t.exports=function(n){var t=n.construct||function(){};return Object.keys(n).forEach(function(e){"construct"!==e&&(t.prototype[e]=n[e])}),t}},{}]},{},[5]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJub2RlX21vZHVsZXMvaW5zZXJ0LWNzcy9pbmRleC5qcyIsInBpY2tlci5taW4uanMiLCJzcmMvanMvcGlja2VyL2NvbXBvbmVudHMvbW9kYWwvaW5kZXguY3NzIiwic3JjL2pzL3BpY2tlci9jb21wb25lbnRzL21vZGFsL2luZGV4Lmh0bWwiLCJzcmMvanMvcGlja2VyL2NvbXBvbmVudHMvbW9kYWwvaW5kZXguanMiLCJzcmMvanMvcGlja2VyL2luZGV4LmpzIiwic3JjL2pzL3BpY2tlci91dGlsL2NyZWF0ZUNsYXNzLmpzIl0sIm5hbWVzIjpbImUiLCJ0IiwibiIsInIiLCJzIiwibyIsInUiLCJhIiwicmVxdWlyZSIsImkiLCJmIiwiRXJyb3IiLCJjb2RlIiwibCIsImV4cG9ydHMiLCJjYWxsIiwibGVuZ3RoIiwiMSIsIm1vZHVsZSIsImNyZWF0ZVN0eWxlRWxlbWVudCIsInN0eWxlRWxlbWVudCIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsInNldEF0dHJpYnV0ZSIsImNvbnRhaW5lcnMiLCJzdHlsZUVsZW1lbnRzIiwiY3NzIiwib3B0aW9ucyIsInBvc2l0aW9uIiwicHJlcGVuZCIsImNvbnRhaW5lciIsInVuZGVmaW5lZCIsInF1ZXJ5U2VsZWN0b3IiLCJjb250YWluZXJJZCIsImluZGV4T2YiLCJwdXNoIiwiaW5zZXJ0QmVmb3JlIiwiY2hpbGROb2RlcyIsImFwcGVuZENoaWxkIiwic3R5bGVTaGVldCIsImNzc1RleHQiLCJ0ZXh0Q29udGVudCIsIjIiLCIzIiwiNCIsImluc2VydENzcyIsImFkZENsYXNzIiwiZWxlbWVudCIsImNsYXNzTmFtZSIsInNwbGl0IiwicmVtb3ZlQ2xhc3MiLCJjbGFzc05hbWVzIiwibmV3Q2xhc3NOYW1lcyIsImpvaW4iLCJ0cmFuc2l0aW9uRXZlbnQiLCJlbCIsInRyYW5zaXRpb25zIiwidHJhbnNpdGlvbiIsIk9UcmFuc2l0aW9uIiwiTW96VHJhbnNpdGlvbiIsIldlYmtpdFRyYW5zaXRpb24iLCJoYXNPd25Qcm9wZXJ0eSIsInN0eWxlIiwiaGFzVHJhbnNpdGlvbnMiLCJ3aW5kb3ciLCJnZXRDb21wdXRlZFN0eWxlIiwidHJhbnNpdGlvbkR1cmF0aW9uIiwiaGFzVHJhbnNpdGlvbiIsImZpbHRlciIsIm1hdGNoIiwiY29uc3RydWN0IiwiT2JqZWN0Iiwia2V5cyIsImZvckVhY2giLCJrZXkiLCJ0aGlzIiwiYmluZCIsInRlbXBsYXRlIiwib3BlbkNsYXNzTmFtZSIsInNyYyIsIm1vZGFsIiwiZnJhbWUiLCJyZW5kZXIiLCJkaXYiLCJpbm5lckhUTUwiLCJjaGlsZHJlbiIsImFkZEV2ZW50TGlzdGVuZXIiLCJldmVudCIsInRhcmdldCIsImNsb3NlIiwiYm9keSIsIl9tb2RhbENsYXNzIiwib3BlbiIsInRoYXQiLCJzZXRUaW1lb3V0IiwiX2Nsb3NlZCIsImNsb3NlVHJhbnNpdGlvbkhhbmRsZXIiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwiLi4vLi4vdXRpbC9jcmVhdGVDbGFzcyIsIi4vaW5kZXguY3NzIiwiLi9pbmRleC5odG1sIiwiaW5zZXJ0LWNzcyIsIjUiLCJNb2RhbCIsInNjcmlwdFVSTCIsInNjcmlwdHMiLCJnZXRFbGVtZW50c0J5VGFnTmFtZSIsIkFzc2V0UGlja2VyIiwiaW5pdCIsInNsaWNlIiwiYXBwIiwiaW5wdXQiLCJzZWxlY3RvciIsInRydXN0ZWRPcmlnaW4iLCJtYXRjaGVzIiwibG9jYXRpb24iLCJvcmlnaW4iLCJxdWVyeVNlbGVjdG9yQWxsIiwiaW5pdElucHV0IiwiZXZlbnRNZXRob2QiLCJldmVudGVyIiwibWVzc2FnZUV2ZW50Iiwib3JpZ2luYWxFdmVudCIsImhhbmRsZU1lc3NhZ2VGcm9tQXBwIiwiZGF0YSIsInByZXZlbnREZWZhdWx0IiwibWVzc2FnZSIsIi4vY29tcG9uZW50cy9tb2RhbCIsIi4vdXRpbC9jcmVhdGVDbGFzcyIsIjYiLCJwcm9wZXJ0aWVzIiwi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MUMsS0FBQWhELFFBQUFvRixNQUFBQyxVQUFBdkMsUUFBQUUsS0FBQTJDLFVBQUExQyxLQUFBRCxNQUVBLElBQUE0QyxHQUFBdkQsT0FBQXNCLGlCQUFBLG1CQUFBLGNBQ0FrQyxFQUFBeEQsT0FBQXVELEdBQ0FFLEVBQUEsZUFBQUYsRUFBQSxZQUFBLFNBQ0FDLEdBQUFDLEVBQUEsU0FBQXpILEdBQ0EsR0FBQW9ILEdBQUFwSCxFQUFBb0gsUUFBQXBILEVBQUEwSCxjQUFBTixNQUNBQSxLQUFBekMsS0FBQXNDLGVBQ0F0QyxLQUFBZ0QscUJBQUEzSCxFQUFBNEgsT0FFQWhELEtBQUFELE9BQUEsSUFFQTJDLFVBQUEsU0FBQXZFLEdBQ0FBLEVBQUF1QyxpQkFBQSxRQUFBLFNBQUFDLEdBQ0FBLEVBQUFzQyxpQkFDQWxELEtBQUFLLE1BQUFZLFFBQ0FoQixLQUFBRCxRQUVBZ0QscUJBQUEsU0FBQUcsR0FDQSxXQUFBQSxHQUNBbkQsS0FBQUssTUFBQVMsVUFLQXpCLFFBQUEyQyxZQUFBLEdBQUFBLEtKMkpHb0IscUJBQXFCLEVBQUVDLHFCQUFxQixJQUFJQyxHQUFHLFNBQVN6SCxFQUFRVSxFQUFPSixHS25OOUVJLEVBQUFKLFFBQUEsU0FBQW9ILEdBQ0EsR0FBQUMsR0FBQUQsRUFBQTVELFdBQUEsWUFNQSxPQUxBQyxRQUFBQyxLQUFBMEQsR0FBQXpELFFBQUEsU0FBQUMsR0FDQSxjQUFBQSxJQUNBeUQsRUFBQUMsVUFBQTFELEdBQUF3RCxFQUFBeEQsTUFHQXlELGFMdU5XIiwiZmlsZSI6InBpY2tlci5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsInZhciBjb250YWluZXJzID0gW107IC8vIHdpbGwgc3RvcmUgY29udGFpbmVyIEhUTUxFbGVtZW50IHJlZmVyZW5jZXNcbnZhciBzdHlsZUVsZW1lbnRzID0gW107IC8vIHdpbGwgc3RvcmUge3ByZXBlbmQ6IEhUTUxFbGVtZW50LCBhcHBlbmQ6IEhUTUxFbGVtZW50fVxuXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChjc3MsIG9wdGlvbnMpIHtcbiAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcblxuICAgIHZhciBwb3NpdGlvbiA9IG9wdGlvbnMucHJlcGVuZCA9PT0gdHJ1ZSA/ICdwcmVwZW5kJyA6ICdhcHBlbmQnO1xuICAgIHZhciBjb250YWluZXIgPSBvcHRpb25zLmNvbnRhaW5lciAhPT0gdW5kZWZpbmVkID8gb3B0aW9ucy5jb250YWluZXIgOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdoZWFkJyk7XG4gICAgdmFyIGNvbnRhaW5lcklkID0gY29udGFpbmVycy5pbmRleE9mKGNvbnRhaW5lcik7XG5cbiAgICAvLyBmaXJzdCB0aW1lIHdlIHNlZSB0aGlzIGNvbnRhaW5lciwgY3JlYXRlIHRoZSBuZWNlc3NhcnkgZW50cmllc1xuICAgIGlmIChjb250YWluZXJJZCA9PT0gLTEpIHtcbiAgICAgICAgY29udGFpbmVySWQgPSBjb250YWluZXJzLnB1c2goY29udGFpbmVyKSAtIDE7XG4gICAgICAgIHN0eWxlRWxlbWVudHNbY29udGFpbmVySWRdID0ge307XG4gICAgfVxuXG4gICAgLy8gdHJ5IHRvIGdldCB0aGUgY29ycmVwb25kaW5nIGNvbnRhaW5lciArIHBvc2l0aW9uIHN0eWxlRWxlbWVudCwgY3JlYXRlIGl0IG90aGVyd2lzZVxuICAgIHZhciBzdHlsZUVsZW1lbnQ7XG5cbiAgICBpZiAoc3R5bGVFbGVtZW50c1tjb250YWluZXJJZF0gIT09IHVuZGVmaW5lZCAmJiBzdHlsZUVsZW1lbnRzW2NvbnRhaW5lcklkXVtwb3NpdGlvbl0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBzdHlsZUVsZW1lbnQgPSBzdHlsZUVsZW1lbnRzW2NvbnRhaW5lcklkXVtwb3NpdGlvbl07XG4gICAgfSBlbHNlIHtcbiAgICAgICAgc3R5bGVFbGVtZW50ID0gc3R5bGVFbGVtZW50c1tjb250YWluZXJJZF1bcG9zaXRpb25dID0gY3JlYXRlU3R5bGVFbGVtZW50KCk7XG5cbiAgICAgICAgaWYgKHBvc2l0aW9uID09PSAncHJlcGVuZCcpIHtcbiAgICAgICAgICAgIGNvbnRhaW5lci5pbnNlcnRCZWZvcmUoc3R5bGVFbGVtZW50LCBjb250YWluZXIuY2hpbGROb2Rlc1swXSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoc3R5bGVFbGVtZW50KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8vIGFjdHVhbGx5IGFkZCB0aGUgc3R5bGVzaGVldFxuICAgIGlmIChzdHlsZUVsZW1lbnQuc3R5bGVTaGVldCkge1xuICAgICAgICBzdHlsZUVsZW1lbnQuc3R5bGVTaGVldC5jc3NUZXh0ICs9IGNzc1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHN0eWxlRWxlbWVudC50ZXh0Q29udGVudCArPSBjc3M7XG4gICAgfVxuXG4gICAgcmV0dXJuIHN0eWxlRWxlbWVudDtcbn07XG5cbmZ1bmN0aW9uIGNyZWF0ZVN0eWxlRWxlbWVudCgpIHtcbiAgICB2YXIgc3R5bGVFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3R5bGUnKTtcbiAgICBzdHlsZUVsZW1lbnQuc2V0QXR0cmlidXRlKCd0eXBlJywgJ3RleHQvY3NzJyk7XG4gICAgcmV0dXJuIHN0eWxlRWxlbWVudDtcbn1cbiIsIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pKHsxOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXtcbnZhciBjb250YWluZXJzID0gW107IC8vIHdpbGwgc3RvcmUgY29udGFpbmVyIEhUTUxFbGVtZW50IHJlZmVyZW5jZXNcbnZhciBzdHlsZUVsZW1lbnRzID0gW107IC8vIHdpbGwgc3RvcmUge3ByZXBlbmQ6IEhUTUxFbGVtZW50LCBhcHBlbmQ6IEhUTUxFbGVtZW50fVxuXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChjc3MsIG9wdGlvbnMpIHtcbiAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcblxuICAgIHZhciBwb3NpdGlvbiA9IG9wdGlvbnMucHJlcGVuZCA9PT0gdHJ1ZSA/ICdwcmVwZW5kJyA6ICdhcHBlbmQnO1xuICAgIHZhciBjb250YWluZXIgPSBvcHRpb25zLmNvbnRhaW5lciAhPT0gdW5kZWZpbmVkID8gb3B0aW9ucy5jb250YWluZXIgOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdoZWFkJyk7XG4gICAgdmFyIGNvbnRhaW5lcklkID0gY29udGFpbmVycy5pbmRleE9mKGNvbnRhaW5lcik7XG5cbiAgICAvLyBmaXJzdCB0aW1lIHdlIHNlZSB0aGlzIGNvbnRhaW5lciwgY3JlYXRlIHRoZSBuZWNlc3NhcnkgZW50cmllc1xuICAgIGlmIChjb250YWluZXJJZCA9PT0gLTEpIHtcbiAgICAgICAgY29udGFpbmVySWQgPSBjb250YWluZXJzLnB1c2goY29udGFpbmVyKSAtIDE7XG4gICAgICAgIHN0eWxlRWxlbWVudHNbY29udGFpbmVySWRdID0ge307XG4gICAgfVxuXG4gICAgLy8gdHJ5IHRvIGdldCB0aGUgY29ycmVwb25kaW5nIGNvbnRhaW5lciArIHBvc2l0aW9uIHN0eWxlRWxlbWVudCwgY3JlYXRlIGl0IG90aGVyd2lzZVxuICAgIHZhciBzdHlsZUVsZW1lbnQ7XG5cbiAgICBpZiAoc3R5bGVFbGVtZW50c1tjb250YWluZXJJZF0gIT09IHVuZGVmaW5lZCAmJiBzdHlsZUVsZW1lbnRzW2NvbnRhaW5lcklkXVtwb3NpdGlvbl0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBzdHlsZUVsZW1lbnQgPSBzdHlsZUVsZW1lbnRzW2NvbnRhaW5lcklkXVtwb3NpdGlvbl07XG4gICAgfSBlbHNlIHtcbiAgICAgICAgc3R5bGVFbGVtZW50ID0gc3R5bGVFbGVtZW50c1tjb250YWluZXJJZF1bcG9zaXRpb25dID0gY3JlYXRlU3R5bGVFbGVtZW50KCk7XG5cbiAgICAgICAgaWYgKHBvc2l0aW9uID09PSAncHJlcGVuZCcpIHtcbiAgICAgICAgICAgIGNvbnRhaW5lci5pbnNlcnRCZWZvcmUoc3R5bGVFbGVtZW50LCBjb250YWluZXIuY2hpbGROb2Rlc1swXSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoc3R5bGVFbGVtZW50KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8vIGFjdHVhbGx5IGFkZCB0aGUgc3R5bGVzaGVldFxuICAgIGlmIChzdHlsZUVsZW1lbnQuc3R5bGVTaGVldCkge1xuICAgICAgICBzdHlsZUVsZW1lbnQuc3R5bGVTaGVldC5jc3NUZXh0ICs9IGNzc1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHN0eWxlRWxlbWVudC50ZXh0Q29udGVudCArPSBjc3M7XG4gICAgfVxuXG4gICAgcmV0dXJuIHN0eWxlRWxlbWVudDtcbn07XG5cbmZ1bmN0aW9uIGNyZWF0ZVN0eWxlRWxlbWVudCgpIHtcbiAgICB2YXIgc3R5bGVFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3R5bGUnKTtcbiAgICBzdHlsZUVsZW1lbnQuc2V0QXR0cmlidXRlKCd0eXBlJywgJ3RleHQvY3NzJyk7XG4gICAgcmV0dXJuIHN0eWxlRWxlbWVudDtcbn1cblxufSx7fV0sMjpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7XG5tb2R1bGUuZXhwb3J0cyA9ICcuYXNzZXRwaWNrZXItbW9kYWwge1xcbiAgICBwb3NpdGlvbjogZml4ZWQ7XFxuICAgIHRvcDogMDtcXG4gICAgYm90dG9tOiAwO1xcbiAgICBsZWZ0OiAwO1xcbiAgICByaWdodDogMDtcXG4gICAgYmFja2dyb3VuZDogcmdiYSgwLCAwLCAwLCAwKTtcXG4gICAgei1pbmRleDogLTE7XFxuICAgIHRyYW5zaXRpb246IGJhY2tncm91bmQgMC4ycywgei1pbmRleCAwcyAwLjJzO1xcbn1cXG4uYXNzZXRwaWNrZXItbW9kYWwuYXNzZXRwaWNrZXItbW9kYWwtb3BlbiB7XFxuICAgIHotaW5kZXg6MzAwMDtcXG4gICAgYmFja2dyb3VuZDogcmdiYSgwLCAwLCAwLCAwLjgpO1xcbiAgICB0cmFuc2l0aW9uOiBiYWNrZ3JvdW5kIDAuMnNcXG59XFxuLmFzc2V0cGlja2VyLW1vZGFsIC5hc3NldHBpY2tlci1tb2RhbC1pbm5lciB7XFxuICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTtcXG4gICAgbGVmdDozMHB4O1xcbiAgICByaWdodDozMHB4O1xcbiAgICB0b3A6MzBweDtcXG4gICAgYm90dG9tOjMwcHg7XFxuICAgIGJhY2tncm91bmQ6ICNmZmY7XFxuICAgIG9wYWNpdHk6IDA7XFxuICAgIHRyYW5zaXRpb246IG9wYWNpdHkgMC4xcyAwLjFzO1xcbiAgICBib3JkZXItcmFkaXVzOiA0cHg7XFxuICAgIG92ZXJmbG93OiBoaWRkZW47XFxufVxcbi5hc3NldHBpY2tlci1tb2RhbC5hc3NldHBpY2tlci1tb2RhbC1vcGVuIC5hc3NldHBpY2tlci1tb2RhbC1pbm5lciB7XFxuICAgIG9wYWNpdHk6IDE7XFxufVxcbi5hc3NldHBpY2tlci1tb2RhbCAuYXNzZXRwaWNrZXItbW9kYWwtaW5uZXIgaWZyYW1lIHtcXG4gICAgcG9zaXRpb246IGFic29sdXRlO1xcbiAgICB3aWR0aDoxMDAlO1xcbiAgICBoZWlnaHQ6IDEwMCU7XFxuICAgIG92ZXJmbG93OiBoaWRkZW47XFxuICAgIGJvcmRlcjogbm9uZTtcXG59XFxuJztcbn0se31dLDM6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpe1xubW9kdWxlLmV4cG9ydHMgPSAnPGRpdiBjbGFzcz1cImFzc2V0cGlja2VyLW1vZGFsXCI+XFxuICAgIDxkaXYgY2xhc3M9XCJhc3NldHBpY2tlci1tb2RhbC1pbm5lclwiPlxcbiAgICAgICAgPGlmcmFtZSBzcmM9XCJcIj5cXG4gICAgICAgICAgICBFaG0sIHdpdGhvdXQgaWZyYW1lcyBpIGFpblxcJ3QgZG8gbm90aGluZy5cXG4gICAgICAgIDwvaWZyYW1lPlxcbiAgICA8L2Rpdj5cXG48L2Rpdj5cXG4nO1xufSx7fV0sNDpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7XG52YXIgaW5zZXJ0Q3NzID0gcmVxdWlyZSgnaW5zZXJ0LWNzcycpLFxuICAgIGFkZENsYXNzID0gZnVuY3Rpb24oZWxlbWVudCwgY2xhc3NOYW1lKSB7XG4gICAgICAgIGlmIChlbGVtZW50LmNsYXNzTmFtZS5zcGxpdCgnICcpLmluZGV4T2YoY2xhc3NOYW1lKSA9PT0gLTEpIHtcbiAgICAgICAgICAgIGVsZW1lbnQuY2xhc3NOYW1lICs9ICcgJyArIGNsYXNzTmFtZTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAgcmVtb3ZlQ2xhc3MgPSBmdW5jdGlvbihlbGVtZW50LCBjbGFzc05hbWUpIHtcbiAgICAgICAgdmFyIGNsYXNzTmFtZXMgPSBlbGVtZW50LmNsYXNzTmFtZS5zcGxpdCgnICcpLCBuZXdDbGFzc05hbWVzID0gW107XG4gICAgICAgIGZvciAodmFyIGkgPSAwLCBsID0gY2xhc3NOYW1lcy5sZW5ndGg7IGkgPCBsOyBpKyspIHtcbiAgICAgICAgICAgIGlmIChjbGFzc05hbWVzW2ldICE9PSBjbGFzc05hbWUpIHtcbiAgICAgICAgICAgICAgICBuZXdDbGFzc05hbWVzLnB1c2goY2xhc3NOYW1lc1tpXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxlbWVudC5jbGFzc05hbWUgPSBuZXdDbGFzc05hbWVzLmpvaW4oJyAnKTtcbiAgICB9LFxuICAgIHRyYW5zaXRpb25FdmVudCA9IChmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIHZhciB0cmFuc2l0aW9ucyA9IHtcbiAgICAgICAgICAgICd0cmFuc2l0aW9uJzogJ3RyYW5zaXRpb25lbmQnLFxuICAgICAgICAgICAgJ09UcmFuc2l0aW9uJzogJ290cmFuc2l0aW9uZW5kJyxcbiAgICAgICAgICAgICdNb3pUcmFuc2l0aW9uJzogJ3RyYW5zaXRpb25lbmQnLFxuICAgICAgICAgICAgJ1dlYmtpdFRyYW5zaXRpb24nOiAnd2Via2l0VHJhbnNpdGlvbkVuZCdcbiAgICAgICAgfTtcbiAgICAgICAgZm9yICh2YXIgaSBpbiB0cmFuc2l0aW9ucykge1xuICAgICAgICAgICAgaWYgKHRyYW5zaXRpb25zLmhhc093blByb3BlcnR5KGkpICYmIGVsLnN0eWxlW2ldICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJhbnNpdGlvbnNbaV07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9KSgpLFxuICAgIGhhc1RyYW5zaXRpb25zID0gZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICB2YXIgY3NzID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUoZWxlbWVudCwgbnVsbCk7XG4gICAgICAgIHZhciB0cmFuc2l0aW9uRHVyYXRpb24gPSBbJ3RyYW5zaXRpb25EdXJhdGlvbicsICdvVHJhbnNpdGlvbkR1cmF0aW9uJywgJ01velRyYW5zaXRpb25EdXJhdGlvbicsICd3ZWJraXRUcmFuc2l0aW9uRHVyYXRpb24nXTtcbiAgICAgICAgdmFyIGhhc1RyYW5zaXRpb24gPSB0cmFuc2l0aW9uRHVyYXRpb24uZmlsdGVyKGZ1bmN0aW9uIChpKSB7XG4gICAgICAgICAgICBpZiAodHlwZW9mIGNzc1tpXSA9PT0gJ3N0cmluZycgJiYgY3NzW2ldLm1hdGNoKC9bMS05XS8pKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gaGFzVHJhbnNpdGlvbi5sZW5ndGggPyB0cnVlIDogZmFsc2U7XG4gICAgfTtcblxubW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlKCcuLi8uLi91dGlsL2NyZWF0ZUNsYXNzJykoe1xuICAgIGNvbnN0cnVjdDogZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICAgICAgaWYgKG9wdGlvbnMpIHtcbiAgICAgICAgICAgIE9iamVjdC5rZXlzKG9wdGlvbnMpLmZvckVhY2goKGZ1bmN0aW9uKGtleSkge1xuICAgICAgICAgICAgICAgIHRoaXMub3B0aW9uc1trZXldID0gb3B0aW9uc1trZXldO1xuICAgICAgICAgICAgfSkuYmluZCh0aGlzKSk7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIG9wdGlvbnM6IHtcbiAgICAgICAgdGVtcGxhdGU6IHJlcXVpcmUoJy4vaW5kZXguaHRtbCcpLFxuICAgICAgICBjc3M6IHJlcXVpcmUoJy4vaW5kZXguY3NzJyksXG4gICAgICAgIG9wZW5DbGFzc05hbWU6ICdhc3NldHBpY2tlci1tb2RhbC1vcGVuJyxcbiAgICAgICAgc3JjOiBudWxsXG4gICAgfSxcbiAgICBtb2RhbDogbnVsbCxcbiAgICBmcmFtZTogbnVsbCxcbiAgICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAodGhpcy5vcHRpb25zLmNzcykge1xuICAgICAgICAgICAgaW5zZXJ0Q3NzKHRoaXMub3B0aW9ucy5jc3MpO1xuICAgICAgICB9XG4gICAgICAgIHZhciBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgZGl2LmlubmVySFRNTCA9IHRoaXMub3B0aW9ucy50ZW1wbGF0ZTtcbiAgICAgICAgdGhpcy5tb2RhbCA9IGRpdi5jaGlsZHJlblswXTtcbiAgICAgICAgdGhpcy5tb2RhbC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgICBpZiAoZXZlbnQudGFyZ2V0ID09PSB0aGlzLm1vZGFsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgICAgICB0aGlzLmZyYW1lID0gdGhpcy5tb2RhbC5xdWVyeVNlbGVjdG9yKCdpZnJhbWUnKTtcbiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCh0aGlzLm1vZGFsKTtcbiAgICAgICAgdGhpcy5fbW9kYWxDbGFzcyA9IHRoaXMubW9kYWwuY2xhc3NOYW1lO1xuICAgIH0sXG4gICAgb3BlbjogZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICghdGhpcy5tb2RhbCkge1xuICAgICAgICAgICAgdGhpcy5yZW5kZXIoKTtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICAgICAgICAgIHdpbmRvdy5zZXRUaW1lb3V0KGZ1bmN0aW9uKCkgeyB0aGF0Lm9wZW4oKTsgfSwgMSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5mcmFtZS5zcmMgPSB0aGlzLm9wdGlvbnMuc3JjO1xuICAgICAgICBhZGRDbGFzcyh0aGlzLm1vZGFsLCB0aGlzLm9wdGlvbnMub3BlbkNsYXNzTmFtZSk7XG4gICAgfSxcbiAgICBfY2xvc2VkOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5mcmFtZS5zcmMgPSAnJztcbiAgICB9LFxuICAgIGNsb3NlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKHRyYW5zaXRpb25FdmVudCAmJiBoYXNUcmFuc2l0aW9ucyh0aGlzLm1vZGFsKSkge1xuICAgICAgICAgICAgdmFyIGNsb3NlVHJhbnNpdGlvbkhhbmRsZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5tb2RhbC5yZW1vdmVFdmVudExpc3RlbmVyKHRyYW5zaXRpb25FdmVudCwgY2xvc2VUcmFuc2l0aW9uSGFuZGxlcik7XG4gICAgICAgICAgICAgICAgdGhpcy5fY2xvc2VkKCk7XG4gICAgICAgICAgICB9LmJpbmQodGhpcyk7XG4gICAgICAgICAgICB0aGlzLm1vZGFsLmFkZEV2ZW50TGlzdGVuZXIodHJhbnNpdGlvbkV2ZW50LCBjbG9zZVRyYW5zaXRpb25IYW5kbGVyKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuX2Nsb3NlZCgpO1xuICAgICAgICB9XG4gICAgICAgIHJlbW92ZUNsYXNzKHRoaXMubW9kYWwsIHRoaXMub3B0aW9ucy5vcGVuQ2xhc3NOYW1lKTtcbiAgICB9XG59KTtcblxufSx7XCIuLi8uLi91dGlsL2NyZWF0ZUNsYXNzXCI6NixcIi4vaW5kZXguY3NzXCI6MixcIi4vaW5kZXguaHRtbFwiOjMsXCJpbnNlcnQtY3NzXCI6MX1dLDU6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpe1xudmFyIE1vZGFsID0gcmVxdWlyZSgnLi9jb21wb25lbnRzL21vZGFsJyk7XG5cbnZhciBzY3JpcHRVUkwgPSAoZnVuY3Rpb24oKSB7XG4gICAgdmFyIHNjcmlwdHMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnc2NyaXB0Jyk7XG4gICAgcmV0dXJuIHNjcmlwdHNbc2NyaXB0cy5sZW5ndGggLSAxXS5zcmM7XG59KSgpO1xuXG52YXIgQXNzZXRQaWNrZXIgPSByZXF1aXJlKCcuL3V0aWwvY3JlYXRlQ2xhc3MnKSh7XG4gICAgY29uc3RydWN0OiBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCB0aGlzLmluaXQuYmluZCh0aGlzKSk7XG4gICAgICAgIC8vIFRPRE86IGV4dGVuZCh0aGlzLm9wdGlvbnMsIG9wdGlvbnMpO1xuICAgICAgICBpZiAoIXRoaXMub3B0aW9ucy5tb2RhbC5zcmMpIHtcbiAgICAgICAgICAgIHRoaXMub3B0aW9ucy5tb2RhbC5zcmMgPSBzY3JpcHRVUkwuc3BsaXQoJy8nKS5zbGljZSgwLCAtMykuam9pbignLycpO1xuICAgICAgICB9XG4gICAgfSxcbiAgICBtb2RhbDogbnVsbCxcbiAgICBvcHRpb25zOiB7XG4gICAgICAgIGFwcDoge1xuICAgICAgICB9LFxuICAgICAgICBpbnB1dDoge1xuICAgICAgICAgICAgc2VsZWN0b3I6ICdbcmVsPVwiYXNzZXRwaWNrZXJcIl0nXG4gICAgICAgIH0sXG4gICAgICAgIG1vZGFsOiB7XG4gICAgICAgICAgICBzcmM6IG51bGxcbiAgICAgICAgfVxuICAgIH0sXG4gICAgdHJ1c3RlZE9yaWdpbjogbnVsbCxcbiAgICBpbml0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIG1hdGNoZXMgPSB0aGlzLm9wdGlvbnMubW9kYWwuc3JjLm1hdGNoKC9eaHR0cDpcXC9cXC9bXlxcL10rLyk7XG4gICAgICAgIHRoaXMudHJ1c3RlZE9yaWdpbiA9IG1hdGNoZXMgPyBtYXRjaGVzWzBdIDogZG9jdW1lbnQubG9jYXRpb24ub3JpZ2luO1xuICAgICAgICB0aGlzLm1vZGFsID0gbmV3IE1vZGFsKHRoaXMub3B0aW9ucy5tb2RhbCk7XG4gICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwodGhpcy5vcHRpb25zLmlucHV0LnNlbGVjdG9yKS5mb3JFYWNoKHRoaXMuaW5pdElucHV0LmJpbmQodGhpcykpO1xuXG4gICAgICAgIHZhciBldmVudE1ldGhvZCA9IHdpbmRvdy5hZGRFdmVudExpc3RlbmVyID8gXCJhZGRFdmVudExpc3RlbmVyXCIgOiBcImF0dGFjaEV2ZW50XCI7XG4gICAgICAgIHZhciBldmVudGVyID0gd2luZG93W2V2ZW50TWV0aG9kXTtcbiAgICAgICAgdmFyIG1lc3NhZ2VFdmVudCA9IGV2ZW50TWV0aG9kID09IFwiYXR0YWNoRXZlbnRcIiA/IFwib25tZXNzYWdlXCIgOiBcIm1lc3NhZ2VcIjtcbiAgICAgICAgZXZlbnRlcihtZXNzYWdlRXZlbnQsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIHZhciBvcmlnaW4gPSBlLm9yaWdpbiB8fCBlLm9yaWdpbmFsRXZlbnQub3JpZ2luO1xuICAgICAgICAgICAgaWYgKG9yaWdpbiA9PT0gdGhpcy50cnVzdGVkT3JpZ2luKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVNZXNzYWdlRnJvbUFwcChlLmRhdGEpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LmJpbmQodGhpcyksIGZhbHNlKTtcbiAgICB9LFxuICAgIGluaXRJbnB1dDogZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgICAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgdGhpcy5tb2RhbC5vcGVuKCk7XG4gICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgfSxcbiAgICBoYW5kbGVNZXNzYWdlRnJvbUFwcDogZnVuY3Rpb24obWVzc2FnZSkge1xuICAgICAgICBpZiAobWVzc2FnZSA9PT0gJ2NhbmNlbCcpIHtcbiAgICAgICAgICAgIHRoaXMubW9kYWwuY2xvc2UoKTtcbiAgICAgICAgfVxuICAgIH1cbn0pO1xuXG53aW5kb3cuQXNzZXRQaWNrZXIgPSBuZXcgQXNzZXRQaWNrZXIoKTtcblxufSx7XCIuL2NvbXBvbmVudHMvbW9kYWxcIjo0LFwiLi91dGlsL2NyZWF0ZUNsYXNzXCI6Nn1dLDY6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpe1xubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihwcm9wZXJ0aWVzKSB7XG4gICAgdmFyIHJlc3VsdCA9IHByb3BlcnRpZXMuY29uc3RydWN0IHx8IGZ1bmN0aW9uKCkgeyB9O1xuICAgIE9iamVjdC5rZXlzKHByb3BlcnRpZXMpLmZvckVhY2goZnVuY3Rpb24oa2V5KSB7XG4gICAgICAgIGlmIChrZXkgIT09ICdjb25zdHJ1Y3QnKSB7XG4gICAgICAgICAgICByZXN1bHQucHJvdG90eXBlW2tleV0gPSBwcm9wZXJ0aWVzW2tleV07XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcblxufSx7fV19LHt9LFs1XSlcblxuIiwibW9kdWxlLmV4cG9ydHMgPSAnLmFzc2V0cGlja2VyLW1vZGFsIHtcXG4gICAgcG9zaXRpb246IGZpeGVkO1xcbiAgICB0b3A6IDA7XFxuICAgIGJvdHRvbTogMDtcXG4gICAgbGVmdDogMDtcXG4gICAgcmlnaHQ6IDA7XFxuICAgIGJhY2tncm91bmQ6IHJnYmEoMCwgMCwgMCwgMCk7XFxuICAgIHotaW5kZXg6IC0xO1xcbiAgICB0cmFuc2l0aW9uOiBiYWNrZ3JvdW5kIDAuMnMsIHotaW5kZXggMHMgMC4ycztcXG59XFxuLmFzc2V0cGlja2VyLW1vZGFsLmFzc2V0cGlja2VyLW1vZGFsLW9wZW4ge1xcbiAgICB6LWluZGV4OjMwMDA7XFxuICAgIGJhY2tncm91bmQ6IHJnYmEoMCwgMCwgMCwgMC44KTtcXG4gICAgdHJhbnNpdGlvbjogYmFja2dyb3VuZCAwLjJzXFxufVxcbi5hc3NldHBpY2tlci1tb2RhbCAuYXNzZXRwaWNrZXItbW9kYWwtaW5uZXIge1xcbiAgICBwb3NpdGlvbjogYWJzb2x1dGU7XFxuICAgIGxlZnQ6MzBweDtcXG4gICAgcmlnaHQ6MzBweDtcXG4gICAgdG9wOjMwcHg7XFxuICAgIGJvdHRvbTozMHB4O1xcbiAgICBiYWNrZ3JvdW5kOiAjZmZmO1xcbiAgICBvcGFjaXR5OiAwO1xcbiAgICB0cmFuc2l0aW9uOiBvcGFjaXR5IDAuMXMgMC4xcztcXG4gICAgYm9yZGVyLXJhZGl1czogNHB4O1xcbiAgICBvdmVyZmxvdzogaGlkZGVuO1xcbn1cXG4uYXNzZXRwaWNrZXItbW9kYWwuYXNzZXRwaWNrZXItbW9kYWwtb3BlbiAuYXNzZXRwaWNrZXItbW9kYWwtaW5uZXIge1xcbiAgICBvcGFjaXR5OiAxO1xcbn1cXG4uYXNzZXRwaWNrZXItbW9kYWwgLmFzc2V0cGlja2VyLW1vZGFsLWlubmVyIGlmcmFtZSB7XFxuICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTtcXG4gICAgd2lkdGg6MTAwJTtcXG4gICAgaGVpZ2h0OiAxMDAlO1xcbiAgICBvdmVyZmxvdzogaGlkZGVuO1xcbiAgICBib3JkZXI6IG5vbmU7XFxufVxcbic7IiwibW9kdWxlLmV4cG9ydHMgPSAnPGRpdiBjbGFzcz1cImFzc2V0cGlja2VyLW1vZGFsXCI+XFxuICAgIDxkaXYgY2xhc3M9XCJhc3NldHBpY2tlci1tb2RhbC1pbm5lclwiPlxcbiAgICAgICAgPGlmcmFtZSBzcmM9XCJcIj5cXG4gICAgICAgICAgICBFaG0sIHdpdGhvdXQgaWZyYW1lcyBpIGFpblxcJ3QgZG8gbm90aGluZy5cXG4gICAgICAgIDwvaWZyYW1lPlxcbiAgICA8L2Rpdj5cXG48L2Rpdj5cXG4nOyIsInZhciBpbnNlcnRDc3MgPSByZXF1aXJlKCdpbnNlcnQtY3NzJyksXG4gICAgYWRkQ2xhc3MgPSBmdW5jdGlvbihlbGVtZW50LCBjbGFzc05hbWUpIHtcbiAgICAgICAgaWYgKGVsZW1lbnQuY2xhc3NOYW1lLnNwbGl0KCcgJykuaW5kZXhPZihjbGFzc05hbWUpID09PSAtMSkge1xuICAgICAgICAgICAgZWxlbWVudC5jbGFzc05hbWUgKz0gJyAnICsgY2xhc3NOYW1lO1xuICAgICAgICB9XG4gICAgfSxcbiAgICByZW1vdmVDbGFzcyA9IGZ1bmN0aW9uKGVsZW1lbnQsIGNsYXNzTmFtZSkge1xuICAgICAgICB2YXIgY2xhc3NOYW1lcyA9IGVsZW1lbnQuY2xhc3NOYW1lLnNwbGl0KCcgJyksIG5ld0NsYXNzTmFtZXMgPSBbXTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGwgPSBjbGFzc05hbWVzLmxlbmd0aDsgaSA8IGw7IGkrKykge1xuICAgICAgICAgICAgaWYgKGNsYXNzTmFtZXNbaV0gIT09IGNsYXNzTmFtZSkge1xuICAgICAgICAgICAgICAgIG5ld0NsYXNzTmFtZXMucHVzaChjbGFzc05hbWVzW2ldKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbGVtZW50LmNsYXNzTmFtZSA9IG5ld0NsYXNzTmFtZXMuam9pbignICcpO1xuICAgIH0sXG4gICAgdHJhbnNpdGlvbkV2ZW50ID0gKGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgdmFyIHRyYW5zaXRpb25zID0ge1xuICAgICAgICAgICAgJ3RyYW5zaXRpb24nOiAndHJhbnNpdGlvbmVuZCcsXG4gICAgICAgICAgICAnT1RyYW5zaXRpb24nOiAnb3RyYW5zaXRpb25lbmQnLFxuICAgICAgICAgICAgJ01velRyYW5zaXRpb24nOiAndHJhbnNpdGlvbmVuZCcsXG4gICAgICAgICAgICAnV2Via2l0VHJhbnNpdGlvbic6ICd3ZWJraXRUcmFuc2l0aW9uRW5kJ1xuICAgICAgICB9O1xuICAgICAgICBmb3IgKHZhciBpIGluIHRyYW5zaXRpb25zKSB7XG4gICAgICAgICAgICBpZiAodHJhbnNpdGlvbnMuaGFzT3duUHJvcGVydHkoaSkgJiYgZWwuc3R5bGVbaV0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0cmFuc2l0aW9uc1tpXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0pKCksXG4gICAgaGFzVHJhbnNpdGlvbnMgPSBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgIHZhciBjc3MgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShlbGVtZW50LCBudWxsKTtcbiAgICAgICAgdmFyIHRyYW5zaXRpb25EdXJhdGlvbiA9IFsndHJhbnNpdGlvbkR1cmF0aW9uJywgJ29UcmFuc2l0aW9uRHVyYXRpb24nLCAnTW96VHJhbnNpdGlvbkR1cmF0aW9uJywgJ3dlYmtpdFRyYW5zaXRpb25EdXJhdGlvbiddO1xuICAgICAgICB2YXIgaGFzVHJhbnNpdGlvbiA9IHRyYW5zaXRpb25EdXJhdGlvbi5maWx0ZXIoZnVuY3Rpb24gKGkpIHtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgY3NzW2ldID09PSAnc3RyaW5nJyAmJiBjc3NbaV0ubWF0Y2goL1sxLTldLykpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBoYXNUcmFuc2l0aW9uLmxlbmd0aCA/IHRydWUgOiBmYWxzZTtcbiAgICB9O1xuXG5tb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmUoJy4uLy4uL3V0aWwvY3JlYXRlQ2xhc3MnKSh7XG4gICAgY29uc3RydWN0OiBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgICAgICBpZiAob3B0aW9ucykge1xuICAgICAgICAgICAgT2JqZWN0LmtleXMob3B0aW9ucykuZm9yRWFjaCgoZnVuY3Rpb24oa2V5KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5vcHRpb25zW2tleV0gPSBvcHRpb25zW2tleV07XG4gICAgICAgICAgICB9KS5iaW5kKHRoaXMpKTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAgb3B0aW9uczoge1xuICAgICAgICB0ZW1wbGF0ZTogcmVxdWlyZSgnLi9pbmRleC5odG1sJyksXG4gICAgICAgIGNzczogcmVxdWlyZSgnLi9pbmRleC5jc3MnKSxcbiAgICAgICAgb3BlbkNsYXNzTmFtZTogJ2Fzc2V0cGlja2VyLW1vZGFsLW9wZW4nLFxuICAgICAgICBzcmM6IG51bGxcbiAgICB9LFxuICAgIG1vZGFsOiBudWxsLFxuICAgIGZyYW1lOiBudWxsLFxuICAgIHJlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMuY3NzKSB7XG4gICAgICAgICAgICBpbnNlcnRDc3ModGhpcy5vcHRpb25zLmNzcyk7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICBkaXYuaW5uZXJIVE1MID0gdGhpcy5vcHRpb25zLnRlbXBsYXRlO1xuICAgICAgICB0aGlzLm1vZGFsID0gZGl2LmNoaWxkcmVuWzBdO1xuICAgICAgICB0aGlzLm1vZGFsLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAgIGlmIChldmVudC50YXJnZXQgPT09IHRoaXMubW9kYWwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgICAgIHRoaXMuZnJhbWUgPSB0aGlzLm1vZGFsLnF1ZXJ5U2VsZWN0b3IoJ2lmcmFtZScpO1xuICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHRoaXMubW9kYWwpO1xuICAgICAgICB0aGlzLl9tb2RhbENsYXNzID0gdGhpcy5tb2RhbC5jbGFzc05hbWU7XG4gICAgfSxcbiAgICBvcGVuOiBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKCF0aGlzLm1vZGFsKSB7XG4gICAgICAgICAgICB0aGlzLnJlbmRlcigpO1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICAgICAgd2luZG93LnNldFRpbWVvdXQoZnVuY3Rpb24oKSB7IHRoYXQub3BlbigpOyB9LCAxKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmZyYW1lLnNyYyA9IHRoaXMub3B0aW9ucy5zcmM7XG4gICAgICAgIGFkZENsYXNzKHRoaXMubW9kYWwsIHRoaXMub3B0aW9ucy5vcGVuQ2xhc3NOYW1lKTtcbiAgICB9LFxuICAgIF9jbG9zZWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLmZyYW1lLnNyYyA9ICcnO1xuICAgIH0sXG4gICAgY2xvc2U6IGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAodHJhbnNpdGlvbkV2ZW50ICYmIGhhc1RyYW5zaXRpb25zKHRoaXMubW9kYWwpKSB7XG4gICAgICAgICAgICB2YXIgY2xvc2VUcmFuc2l0aW9uSGFuZGxlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB0aGlzLm1vZGFsLnJlbW92ZUV2ZW50TGlzdGVuZXIodHJhbnNpdGlvbkV2ZW50LCBjbG9zZVRyYW5zaXRpb25IYW5kbGVyKTtcbiAgICAgICAgICAgICAgICB0aGlzLl9jbG9zZWQoKTtcbiAgICAgICAgICAgIH0uYmluZCh0aGlzKTtcbiAgICAgICAgICAgIHRoaXMubW9kYWwuYWRkRXZlbnRMaXN0ZW5lcih0cmFuc2l0aW9uRXZlbnQsIGNsb3NlVHJhbnNpdGlvbkhhbmRsZXIpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5fY2xvc2VkKCk7XG4gICAgICAgIH1cbiAgICAgICAgcmVtb3ZlQ2xhc3ModGhpcy5tb2RhbCwgdGhpcy5vcHRpb25zLm9wZW5DbGFzc05hbWUpO1xuICAgIH1cbn0pO1xuIiwidmFyIE1vZGFsID0gcmVxdWlyZSgnLi9jb21wb25lbnRzL21vZGFsJyk7XG5cbnZhciBzY3JpcHRVUkwgPSAoZnVuY3Rpb24oKSB7XG4gICAgdmFyIHNjcmlwdHMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnc2NyaXB0Jyk7XG4gICAgcmV0dXJuIHNjcmlwdHNbc2NyaXB0cy5sZW5ndGggLSAxXS5zcmM7XG59KSgpO1xuXG52YXIgQXNzZXRQaWNrZXIgPSByZXF1aXJlKCcuL3V0aWwvY3JlYXRlQ2xhc3MnKSh7XG4gICAgY29uc3RydWN0OiBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCB0aGlzLmluaXQuYmluZCh0aGlzKSk7XG4gICAgICAgIC8vIFRPRE86IGV4dGVuZCh0aGlzLm9wdGlvbnMsIG9wdGlvbnMpO1xuICAgICAgICBpZiAoIXRoaXMub3B0aW9ucy5tb2RhbC5zcmMpIHtcbiAgICAgICAgICAgIHRoaXMub3B0aW9ucy5tb2RhbC5zcmMgPSBzY3JpcHRVUkwuc3BsaXQoJy8nKS5zbGljZSgwLCAtMykuam9pbignLycpO1xuICAgICAgICB9XG4gICAgfSxcbiAgICBtb2RhbDogbnVsbCxcbiAgICBvcHRpb25zOiB7XG4gICAgICAgIGFwcDoge1xuICAgICAgICB9LFxuICAgICAgICBpbnB1dDoge1xuICAgICAgICAgICAgc2VsZWN0b3I6ICdbcmVsPVwiYXNzZXRwaWNrZXJcIl0nXG4gICAgICAgIH0sXG4gICAgICAgIG1vZGFsOiB7XG4gICAgICAgICAgICBzcmM6IG51bGxcbiAgICAgICAgfVxuICAgIH0sXG4gICAgdHJ1c3RlZE9yaWdpbjogbnVsbCxcbiAgICBpbml0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIG1hdGNoZXMgPSB0aGlzLm9wdGlvbnMubW9kYWwuc3JjLm1hdGNoKC9eaHR0cDpcXC9cXC9bXlxcL10rLyk7XG4gICAgICAgIHRoaXMudHJ1c3RlZE9yaWdpbiA9IG1hdGNoZXMgPyBtYXRjaGVzWzBdIDogZG9jdW1lbnQubG9jYXRpb24ub3JpZ2luO1xuICAgICAgICB0aGlzLm1vZGFsID0gbmV3IE1vZGFsKHRoaXMub3B0aW9ucy5tb2RhbCk7XG4gICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwodGhpcy5vcHRpb25zLmlucHV0LnNlbGVjdG9yKS5mb3JFYWNoKHRoaXMuaW5pdElucHV0LmJpbmQodGhpcykpO1xuXG4gICAgICAgIHZhciBldmVudE1ldGhvZCA9IHdpbmRvdy5hZGRFdmVudExpc3RlbmVyID8gXCJhZGRFdmVudExpc3RlbmVyXCIgOiBcImF0dGFjaEV2ZW50XCI7XG4gICAgICAgIHZhciBldmVudGVyID0gd2luZG93W2V2ZW50TWV0aG9kXTtcbiAgICAgICAgdmFyIG1lc3NhZ2VFdmVudCA9IGV2ZW50TWV0aG9kID09IFwiYXR0YWNoRXZlbnRcIiA/IFwib25tZXNzYWdlXCIgOiBcIm1lc3NhZ2VcIjtcbiAgICAgICAgZXZlbnRlcihtZXNzYWdlRXZlbnQsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIHZhciBvcmlnaW4gPSBlLm9yaWdpbiB8fCBlLm9yaWdpbmFsRXZlbnQub3JpZ2luO1xuICAgICAgICAgICAgaWYgKG9yaWdpbiA9PT0gdGhpcy50cnVzdGVkT3JpZ2luKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVNZXNzYWdlRnJvbUFwcChlLmRhdGEpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LmJpbmQodGhpcyksIGZhbHNlKTtcbiAgICB9LFxuICAgIGluaXRJbnB1dDogZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgICAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgdGhpcy5tb2RhbC5vcGVuKCk7XG4gICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgfSxcbiAgICBoYW5kbGVNZXNzYWdlRnJvbUFwcDogZnVuY3Rpb24obWVzc2FnZSkge1xuICAgICAgICBpZiAobWVzc2FnZSA9PT0gJ2NhbmNlbCcpIHtcbiAgICAgICAgICAgIHRoaXMubW9kYWwuY2xvc2UoKTtcbiAgICAgICAgfVxuICAgIH1cbn0pO1xuXG53aW5kb3cuQXNzZXRQaWNrZXIgPSBuZXcgQXNzZXRQaWNrZXIoKTtcbiIsIm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24ocHJvcGVydGllcykge1xuICAgIHZhciByZXN1bHQgPSBwcm9wZXJ0aWVzLmNvbnN0cnVjdCB8fCBmdW5jdGlvbigpIHsgfTtcbiAgICBPYmplY3Qua2V5cyhwcm9wZXJ0aWVzKS5mb3JFYWNoKGZ1bmN0aW9uKGtleSkge1xuICAgICAgICBpZiAoa2V5ICE9PSAnY29uc3RydWN0Jykge1xuICAgICAgICAgICAgcmVzdWx0LnByb3RvdHlwZVtrZXldID0gcHJvcGVydGllc1trZXldO1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
